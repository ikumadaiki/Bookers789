<!-- Bookers2 -->
<main>

  <div class='container px-5 px-sm-0'>


   <!--エラーメッセージここから-->
    <% if @book.errors.any? %>
    <div id="error_explanation">
     <h2><%= @book.errors.count %> errors prohibited this obj from being saved:</h2>
     <ul>
      <% @book.errors.full_messages.each do |message| %>
       <li><%= message %></li>
      <% end %>
     </ul>
    </div>
    <% end %>
   <!--エラーメッセージここまで-->


   <div class='row'>
     <div class='col-md-3'>
      <!-- プロフィール&投稿テンプレート -->
      <%= render 'books/list',user: @user, book: @book %>
     </div>

     <!-- 投稿一覧 -->
     <div class='col-md-8 offset-md-1'>
       <h2>Books</h2>
       <table class='table table-hover table-inverse'>
         <thead>
           <tr>
             <th></th>
             <th>Title</th>
             <th>Opinion</th>
             <th colspan="3"></th>
           </tr>
         </thead>
         <tbody>
           <% @books.each do |book| %>
           <tr>
             <td>
               <%= link_to(user_path(book.user) ,class:"attachment user profile_image fallback")do%>
                 <%= attachment_image_tag book.user, :profile_image, format: 'jpeg', fallback: "no_image.jpg", size: "40x40" %>
               <% end %>
             </td>
             <td>
               <%= link_to book_path(book.id) do %>
                 <%= book.title %>
               <% end %>
             </td>
             <td><%= book.body %></td>
             <!-- コメント数表示 -->
             <td>
              <p><%= "コメント数：#{book.post_comments.count}" %></p>
             </td>
             <!-- コメント数表示ここまで -->
           </tr>
           <% end %>
         </tbody>
       </table>
       <div class="border" style="padding:10px;">
        <table class="table">
          <thead>
            <tr>
             <th>今日の投稿</th>
             <th>昨日の投稿</th>
             <th>前日比</th>
            </tr>
            </thead>
           <tbody>
              <tr>
               <td><%= @today_book.count %></td>
               <td><%= @yesterday_book.count %></td>
               <% if @yesterday_book.count == 0 %>
               <td>前日の投稿はなし</td>
               <% else %>
                 <td><% @the_day_before =   @today_book.count / @yesterday_book.count.to_f  %>
                 <%= (@the_day_before * 100).round %>%</td>
               <% end %>
               </tr>
           </tbody>
          </table>


          <table class="table">
            <thead>
              <tr>
               <th>今週の投稿</th>
               <th>先週の投稿</th>
               <th>週間比</th>
              </tr>
            </thead>
           <tbody>
              <tr>
               <td><%= @this_week_book.count %></td>
               <td><%= @last_week_book.count %></td>
               <% if @last_week_book.count == 0 %>
               <td>先週の投稿はなし</td>
               <% else %>
                 <td><% @the_week_before =   @this_week_book.count / @last_week_book.count.to_f  %>
                 <%= (@the_week_before * 100).round %>%</td>
               <% end %>
               </tr>
          </tbody>
        </table>
      </div>
      <table class='table table-bordered'>
    <h2>7日間分の投稿数</h2>
    <thead>
    <tr>
      <th>6日前</th>
      <th>5日前</th>
      <th>4日前</th>
    　<th>3日前</th>
      <th>2日前</th>
      <th>1日前</th>
      <th>今日</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td><%= @created_6daysago %></td>
      <td><%= @created_5daysago %></td>
      <td><%= @created_4daysago %></td>
      <td><%= @created_3daysago.count %></td>
      <td><%= @created_2daysago.count %></td>
      <td><%= @created_yesterday.count %></td>
      <td><%= @created_today.count %></td>
    </tr>
    </tbody>
</table>

    <div style="width:auto">
      <p>7日間比較</p>
      <canvas id="mychart"></canvas>
    </div>


    <script>
      var ctx = document.getElementById('mychart');
      var myChart = new Chart(ctx, {
      type: 'line',
     data: {
       labels: ['6日前', '5日前', '4日前', '3日前', '2日前', '1日前', '今日'],
       datasets: [{
        label: '投稿した本の数',
        data: [<%= @created_6daysago %>, <%= @created_5daysago %>, <%= @created_4daysago %>, <%= @created_3daysago.count %>, <%= @created_2daysago.count %>, <%= @created_yesterday.count %>, <%= @created_today.count %>],
        borderColor: '#191970',
       }, ],
     },
    options: {
      y: {
        min: 0,
        max: 60,
      },
    },
  });
   </script>

     </div>
   </div>
  </div>
</main>